(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[790],{59568:(e,t,s)=>{"use strict";s.d(t,{A:()=>d,O:()=>c});var a=s(95155),r=s(23464),l=s(12115),n=s(60838),i=s(792);let o=(0,l.createContext)(void 0),c=e=>{let{children:t}=e,[s,c]=(0,l.useState)(()=>{let e=localStorage.getItem("auth_data");return{isAuthChecked:!!e,isLoggedIn:!!e}}),[d,u]=(0,l.useState)(),[h,x]=(0,l.useState)();(0,l.useEffect)(()=>{if(!window.settings)return;let{title:e,description:t}=window.settings;document.title="".concat(e," - ").concat(t),window.settings.crisp_id&&i.YH.configure(window.settings.crisp_id),u(window.settings)},[]);let m=(0,l.useMemo)(()=>{if(!d)return;let{api:e}=d,t=r.A.create({baseURL:new URL("/api/v1",e).toString(),timeout:1e4,headers:{"Content-Type":"application/json"}});return t.interceptors.request.use(e=>{let t=localStorage.getItem("auth_data");return t&&(e.headers.Authorization=t),e}),t.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===403&&(localStorage.removeItem("auth_data"),c(e=>({...e,isLoggedIn:!1}))),Promise.reject(e)}),c(e=>({...e,isAuthChecked:!0})),t},[d]),f=(0,l.useCallback)(async e=>{if(!m)return;let{data:t}=await m.get(e);return t},[m]);(0,l.useEffect)(()=>{m&&localStorage.getItem("auth_data")&&(async()=>{try{await m.get("user/checkLogin"),c(e=>({...e,isLoggedIn:!0}))}catch(e){console.error("Failed to check session:",e)}})()},[m]);let p=(0,l.useCallback)(async()=>{if(m&&!h)try{let e=await m.get("guest/comm/config");x(e.data.data)}catch(e){console.error("Failed to load remote config:",e)}},[m,h]),g=async(e,t)=>{if(m)try{let{data:s}=await m.post("passport/auth/login",{email:e,password:t});localStorage.setItem("auth_data",s.data.auth_data),c(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},j=async(e,t,s,a)=>{if(m)try{let{data:r}=await m.post("passport/auth/register",{email:e,password:t,email_code:s,invite_code:a});localStorage.setItem("auth_data",r.data.auth_data),c(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},w=async(e,t,s)=>{if(m)try{await m.post("passport/auth/forget",{email:e,password:t,email_code:s})}catch(e){throw e}},y=async e=>{if(m)try{await m.post("passport/comm/sendEmailVerify",{email:e})}catch(e){throw e}};return(0,a.jsx)(o.Provider,{value:{isAuthChecked:s.isAuthChecked,isLoggedIn:s.isLoggedIn,request:m,config:d,remoteConfig:h,loadRemoteConfig:p,signIn:g,signUp:j,signOut:()=>{localStorage.removeItem("auth_data"),c({isAuthChecked:!0,isLoggedIn:!1})},sendVerifyCode:y,resetPassword:w},children:(0,a.jsx)(n.BE,{value:{fetcher:f,errorRetryCount:1,errorRetryInterval:100},children:t})})},d=()=>{let e=(0,l.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},69259:(e,t,s)=>{Promise.resolve().then(s.bind(s,71568))},71568:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>L});var a=s(95155),r=s(16863),l=s(91158),n=s(86613),i=s(6610),o=s(20044),c=s(40933),d=s(65701),u=s(75243),h=s(35695),x=s(44849),m=s(15264),f=s(25829);let p=[{label:"首页",href:"/",Icon:x.A},{label:"购买",href:"/shop",Icon:m.A},{label:"邀请",href:"/invite",Icon:f.A}];var g=s(59568),j=s(47839),w=s(19652),y=s(51739),b=s(50766),v=s(13045),A=s(39362),N=s(36871),I=s(51362),k=s(12115);let _=e=>{let{className:t}=e,[s,r]=(0,k.useState)(!1),{theme:l,setTheme:i}=(0,I.D)();(0,k.useEffect)(()=>{r(!0)},[]);let o={light:{label:"浅色模式",Icon:v.A},dark:{label:"深色模式",Icon:A.A},system:{label:"跟随系统",Icon:N.A}};return s?(0,a.jsxs)(j.A,{children:[(0,a.jsx)(w.b,{children:(0,a.jsx)(d.T,{variant:"light",isIconOnly:!0,radius:"full",className:(0,n.cn)("text-foreground",t),children:"light"===l?(0,a.jsx)(v.A,{size:20}):"dark"===l?(0,a.jsx)(A.A,{size:20}):(0,a.jsx)(N.A,{size:20})})}),(0,a.jsx)(y.y,{"aria-label":"Static Actions",children:Object.entries(o).map(e=>{let[t,{label:s,Icon:r}]=e;return(0,a.jsx)(b.Y,{onPress:()=>i(t),className:"flex flex-row items-center gap-2 text-default-500",startContent:(0,a.jsx)(r,{size:16}),children:s},t)})})]}):null};var C=s(40147);function L(e){let{children:t}=e,s=(0,h.usePathname)(),{config:x,isAuthChecked:m,isLoggedIn:f}=(0,g.A)();return x&&m?(0,a.jsxs)("div",{className:"relative flex min-h-dvh w-full flex-col",children:[(0,a.jsx)(r.H,{classNames:{base:"py-4 backdrop-filter-none bg-transparent",wrapper:"px-0 w-full justify-center bg-transparent",item:"hidden md:flex"},height:"60px",children:(0,a.jsxs)(l.t,{className:(0,n.cn)("gap-4 rounded-full px-4","border border-default-200","backdrop-blur-sm backdrop-saturate-150"),justify:"center",children:[(0,a.jsx)(i.$,{className:"max-w-[125px] mx-2",children:(0,a.jsx)("span",{className:"font-bold text-xl text-foreground truncate",children:x.title})}),(0,a.jsx)(l.t,{className:"hidden sm:flex gap-4",justify:"center",children:p.map(e=>{let{label:t,href:r,Icon:l}=e;return(0,a.jsx)(o.p,{isActive:s===r,children:(0,a.jsxs)(c.h,{color:s===r?"primary":"foreground",href:r,className:(0,n.cn)("text-md px-6 py-2 rounded-full",s===r?"font-bold":"text-foreground",s===r?"bg-primary-200/25":null),children:[(0,a.jsx)(l,{size:24,weight:s===r?"BoldDuotone":"LineDuotone"}),(0,a.jsx)("span",{className:"ml-2",children:t})]})},t)})}),(0,a.jsxs)(l.t,{justify:"end",className:"gap-1",children:[(0,a.jsx)(_,{className:"hidden md:flex"}),f?(0,a.jsx)(d.T,{as:c.h,href:"/profile",radius:"full",color:"primary",startContent:(0,a.jsx)(C.A,{size:20,weight:"LineDuotone"}),children:"个人中心"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.T,{radius:"full",variant:"light",color:"primary",as:c.h,href:"/signin",children:"登录"}),(0,a.jsx)(d.T,{radius:"full",color:"primary",as:c.h,href:"/signup",children:"注册"})]})]})]})}),(0,a.jsx)("main",{className:(0,n.cn)("container mx-auto sm:mt-[30px] max-w-6xl","flex flex-col items-center px-8"),children:t}),(0,a.jsx)("footer",{className:"pb-20",children:(0,a.jsxs)("div",{className:"mx-auto max-w-6xl overflow-hidden px-6 py-4 sm:py-12 lg:px-8 flex flex-col items-center",children:[(0,a.jsx)(u.R,{className:"border-none px-0 text-default-500",color:"success",variant:"dot",children:"All systems operational"}),(0,a.jsxs)("p",{className:"mt-1 text-center text-small text-default-400",children:["\xa9 2024 ",x.title,". All rights reserved."]})]})}),(0,a.jsx)("nav",{role:"navigation",className:(0,n.cn)("sm:hidden","fixed bottom-0 left-0 right-0 z-50","backdrop-blur-sm backdrop-saturate-150 border-t border-default-200 shadow-lg"),children:(0,a.jsx)("ul",{className:"flex justify-around max-w-md mx-auto py-2",children:p.map(e=>{let{label:t,href:r,Icon:l}=e,i=s===r;return(0,a.jsx)("li",{className:"flex-1",children:(0,a.jsxs)(c.h,{href:r,className:(0,n.cn)("flex flex-col items-center justify-center transition-colors",i?"text-primary":"text-default-500 hover:text-primary"),children:[(0,a.jsx)(l,{size:24,weight:i?"BoldDuotone":"LineDuotone",className:(0,n.cn)("transition-transform",i&&"scale-110")}),(0,a.jsx)("span",{className:"mt-1 text-xs",children:t})]})},r)})})})]}):null}}},e=>{e.O(0,[84,876,895,330,234,479,216,398,157,441,964,358],()=>e(e.s=69259)),_N_E=e.O()}]);